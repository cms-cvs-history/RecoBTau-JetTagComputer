#!/usr/bin/env cmsRun

process test1 = {
	source = PoolSource {
		untracked vstring fileNames = { 
			"file:ttbar.root"
		}
	}

	include "FWCore/MessageLogger/data/MessageLogger.cfi"
#	replace MessageLogger.cout.threshold = "INFO"

	include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
        include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"
	include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
#	include "Alignment/TrackerAlignment/data/NoMovementsScenario.cff"
#	include "Configuration/StandardSequences/data/Reconstruction.cff"
#	include "Configuration/StandardSequences/data/Simulation.cff"
#	include "Configuration/StandardSequences/data/MixingNoPileUp.cff"
#	include "Configuration/StandardSequences/data/VtxSmearedGauss.cff"

	include "TrackingTools/TransientTrack/data/TransientTrackBuilder.cfi"

	include "RecoVertex/PrimaryVertexProducer/data/OfflinePrimaryVerticesFromCTFTracks.cfi"

	include "RecoJets/JetAssociationProducers/data/ic5JetTracksAssociatorAtVertex.cfi"

	include "RecoBTau/JetTagProducer/data/jetTagRecord.cfi"

	include "RecoBTag/ImpactParameter/data/impactParameter.cff"

	include "CondCore/DBCommon/data/CondDBSetup.cfi"
	es_source = PoolDBESSource {
		using CondDBSetup

		string connect = "sqlite_file:MVATestJetTags.db"
		untracked string catalog = "file:mycatalog.xml"
		string timetype = "runnumber"

		VPSet toGet = {
			{
				string record	= "BTauGenericMVAJetTagComputerRcd"
				string tag	= "test_tag"
			}
		}
	}

	es_module impactParameterMVAComputer = GenericMVAJetTagESProducer {
		bool useCategories = false
		string calibrationRecord = "ImpactParameter"
	}

	module impactParameterMVAJetTags = JetTagProducerImpactParameter { 
		InputTag tagInfo	= impactParameterTagInfos
		string jetTagComputer	= "impactParameterMVAComputer"
	}

	module Output = PoolOutputModule {
		untracked string fileName = 'file:test.root'
		untracked vstring outputCommands = {
			"drop *",
			"keep recoJetTags_*_*_*",
			"keep *_jetTracksAssociator_*_*",
			"keep *_iterativeCone5CaloJets_*_*",
			"keep *_trackCountingJetTags_*_*",
			"keep *_impactParameterTagInfos_*_*",
			"keep recoTrackExtras_*_*_*",
			"keep recoTracks_*_*_*",
			"keep recoVertexs_*_*_*"
		}
	}

	path p = {
		offlinePrimaryVerticesFromCTFTracks,
		jetTracksAssociator,
		impactParameterTagInfos,
		impactParameterMVAJetTags
	}

	endpath outpath = { Output }
}
