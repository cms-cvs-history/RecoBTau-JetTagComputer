#!/usr/bin/env cmsRun

process test1 = {
	source = PoolSource {
		untracked vstring fileNames = { 
			"file:b_jets_1_5_0_pre2.root"
		}
	}

	include "FWCore/MessageLogger/data/MessageLogger.cfi"
	replace MessageLogger.cout.threshold = "INFO"

	include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
        include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"
	include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
#	include "Alignment/TrackerAlignment/data/NoMovementsScenario.cff"
#	include "Configuration/StandardSequences/data/Reconstruction.cff"
#	include "Configuration/StandardSequences/data/Simulation.cff"
#	include "Configuration/StandardSequences/data/MixingNoPileUp.cff"
#	include "Configuration/StandardSequences/data/VtxSmearedGauss.cff"

	include "TrackingTools/TransientTrack/data/TransientTrackBuilder.cfi"

	include "RecoVertex/PrimaryVertexProducer/data/OfflinePrimaryVerticesFromCTFTracks.cfi"

	include "RecoBTau/JetTracksAssociator/data/jetTracksAssociator.cff"
	include "RecoBTag/TrackCounting/data/trackCounting.cff"

	es_source SoftLeptonBTagRecord = EmptyESSource {
		string recordName	= "JetTagComputerRecord"
		vuint32 firstValid	= { 1 }
		bool iovIsRunNotTime	= true
	}

	include "RecoBTag/ImpactParameter/data/impactParameter.cff"

	include "CondCore/DBCommon/data/CondDBSetup.cfi"
	es_source = PoolDBESSource {
		using CondDBSetup

		string connect = "sqlite_file:MVATestJetTags.db"
		untracked string catalog = "file:mycatalog.xml"
		string timetype = "runnumber"

		VPSet toGet = {
			{
				string record	= "BTauGenericMVAJetTagComputerRcd"
				string tag	= "test_tag"
			}
		}
	}

	es_module trackCounting3D3rd = TrackCountingESProducer {
		string ComponentName	= "trackCountingSTD3D3rd"
		PSet JetTagComputerPSet	= { } 
	}

	es_module impactParameterMVAComputer = GenericMVAJetTagESProducer {
		string ComponentName	= "impactParameterMVAComputer"
		PSet JetTagComputerPSet	= {
			string calibrationRecord = "ImpactParameter"
		}
	}

	module impactParameterJTP = JetTagProducerImpactParameter { 
		InputTag tagInfo	= impactParameterTagInfos
		string jetTagComputer	= "trackCountingSTD3D3rd"
	}

	module impactParameterMVAJTP = JetTagProducerImpactParameter { 
		InputTag tagInfo	= impactParameterTagInfos
		string jetTagComputer	= "impactParameterMVAComputer"
	}

	module trackCountingJetTagsJTP = JetTagProducerTrackCounting {
		InputTag tagInfo	= trackCountingJetTags
		string jetTagComputer	= "trackCountingSTD3D3rd"
	}

	module Output = PoolOutputModule {
		untracked string fileName = 'file:test.root'
		untracked vstring outputCommands = {
			"drop *",
			"keep recoJetTags_*_*_*",
			"keep *_jetTracksAssociator_*_*",
			"keep *_iterativeCone5CaloJets_*_*",
			"keep *_trackCountingJetTags_*_*",
			"keep *_impactParameterTagInfos_*_*",
			"keep recoTrackExtras_*_*_*",
			"keep recoTracks_*_*_*",
			"keep recoVertexs_*_*_*"
		}
	}

	path p = {
		offlinePrimaryVerticesFromCTFTracks,
		jetTracksAssociator,
		impactParameterTagInfos,
		trackCountingJetTags,
		impactParameterJTP,
		impactParameterMVAJTP,
		trackCountingJetTagsJTP
	}

	endpath outpath = { Output }
}
